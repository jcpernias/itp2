---
title: itp2-new
format: 
  html: 
    embed-resources: true
    theme: flatly
    
toc: true
number-sections: true
number-depth: 3
date: last-modified

editor: visual
---

## Preliminaries

Load the `tidyverse` packages:

```{r}
#| message: false

library(tidyverse)
```

## Data

Read the database files:

```{r}
load("./data/households.RData")
load("./data/individuals.RData")
load("./data/pov_transition.RData")
```

Filter out data for 2005 edition of ECV and add some variables to the `pov_transition` database:

```{r}
pov <- local({
  tmp <- individuals |>
    select(id_p, birth_year, absent)
  pov_transition |> 
    filter(ecv_year != 2005) |> 
  left_join(tmp, by = "id_p") 
}) 
  
  
```

Create a variable for the different cohorts:

```{r}
pov <- pov |> 
  mutate(cohort = 
           factor(case_when(birth_year %in% 1956:1960 ~ "1956-60",
                            birth_year %in% 1961:1965 ~ "1961-65", 
                            birth_year %in% 1966:1970 ~ "1966-70", 
                            birth_year %in% 1971:1975 ~ "1971-75",
                            birth_year %in% 1976:1980 ~ "1976-80", 
                            birth_year %in% 1981:1985 ~ "1981-85"),
                  levels = c("1956-60", "1961-65", "1966-70", 
                             "1971-75", "1976-80", "1981-85")))
```

Filter out observations of people who do not belong to the chosen cohorts. Create a variable `povteen` that is `TRUE` for individuals who lived in poverty as teenagers.

```{r}
cohorts <- pov |>
  filter(!is.na(cohort)) |> 
  mutate(povteen = well_being %in% c("Very Bad", "Bad")) |> 
  left_join(individuals, by = "id_p") |> 
  left_join(households, by = "id_hh") |> 
  mutate(income = ydisp_hh / cunits,
         teen_no_workers = nworking == 0)
```

Number of people in each cohort by year:

```{r}
cohorts |> 
  count(ecv_year, cohort) |> 
  pivot_wider(names_from = ecv_year, values_from = n)
```

Number of people who lived in poverty as teenagers by cohort and year:

```{r}
cohorts |> 
  filter(povteen == TRUE) |> 
  count(ecv_year, cohort) |> 
  pivot_wider(names_from = ecv_year, values_from = n)
```

Number of people who lived in poverty as adults by cohort and year:

```{r}
cohorts |> 
  filter(pov_hh == TRUE) |> 
  count(ecv_year, cohort) |> 
  pivot_wider(names_from = ecv_year, values_from = n)
```
