---
title: itp2-new
---

## Preliminaries

Load the `tidyverse` packages:

```{r}
#| message: false

library(tidyverse)
```

## Data

Read the database files:

```{r}
load("./data/households.RData")
load("./data/individuals.RData")
load("./data/pov_transition.RData")
```

Filter out data for 2005 edition of ECV and add some variables to the `pov_transition` database:

```{r}
pov <- local({
  tmp <- individuals |>
    select(id_p, birth_year, absent)
  pov_transition |> 
    filter(ecv_year != 2005) |> 
  left_join(tmp, by = "id_p") 
}) 
```

| Birth year | Age at 2010 | Age at 2018 |
|:----------:|:-----------:|:-----------:|
| 1960-1964  |    46-50    |    54-58    |
| 1965-1969  |    41-45    |    49-53    |
| 1970-1974  |    36-40    |    44-48    |
| 1975-1979  |    31-35    |    39-43    |
| 1980-1984  |    26-30    |    34-38    |

: Cohort definition

Create a variable for the different cohorts:

```{r}
pov <- pov |> 
  mutate(cohort = 
           factor(case_when(birth_year %in% 1960:1964 ~ "1960-64", 
                            birth_year %in% 1965:1969 ~ "1965-69", 
                            birth_year %in% 1970:1974 ~ "1970-74",
                            birth_year %in% 1975:1979 ~ "1975-79", 
                            birth_year %in% 1980:1984 ~ "1980-84"),
                  levels = c("1960-64", "1965-69", "1970-74",
                             "1975-79", "1980-84")))
```

Filter out observations of people who do not belong to the chosen cohorts. Create a variable `povteen` that is `TRUE` for individuals who lived in poverty as teenagers.

```{r}
cohorts <- pov |>
  filter(!is.na(cohort)) |> 
  mutate(povteen = well_being %in% c("Very Bad", "Bad")) |> 
  left_join(individuals, by = "id_p") |> 
  left_join(households, by = "id_hh") |> 
  mutate(income = ydisp_hh / cunits,
         teen_no_workers = nworking == 0)
```

Number of people in each cohort by year:

```{r}
cohorts |> 
  count(ecv_year, cohort) |> 
  pivot_wider(names_from = ecv_year, values_from = n)
```

Number of people who lived in poverty as teenagers by cohort and year:

```{r}
cohorts |> 
  filter(povteen == TRUE) |> 
  count(ecv_year, cohort) |> 
  pivot_wider(names_from = ecv_year, values_from = n)
```

Number of people who lived in poverty as adults by cohort and year:

```{r}
cohorts |> 
  filter(pov_hh == TRUE) |> 
  count(ecv_year, cohort) |> 
  pivot_wider(names_from = ecv_year, values_from = n)
```

```{r}
cohorts |> 
  count(ecv_year, cohort, povteen, pov_hh) |> 
  mutate(povtrans = case_when(!povteen & !pov_hh ~ "FF",
                              !povteen & pov_hh ~ "FT",
                              povteen & !pov_hh ~ "TF",
                              povteen & pov_hh ~ "TT")) |> 
  select(-c(povteen, pov_hh)) |> 
  pivot_wider(names_from = povtrans, values_from = n)
```
