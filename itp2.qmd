---
title: "itp2"
format: html
---

## Preliminaries

We load the ~tidyverse~ packages in order to handle the databases:
```{r}
library(tidyverse)
```


## Data

Read the database files:
```{r}
load("./data/households.RData")
load("./data/individuals.RData")
load("./data/pov_transition.RData")
```

Add some variables to the ~pov_transition~ database:
```{r}
pov <- left_join(pov_transition, 
                 select(individuals, c(id_p, birth_year, absent)),
                 by = "id_p") 
```

Create a variable for the different cohorts:
```{r}
pov <- pov |> 
  mutate(cohort = factor(case_when(birth_year %in% 1960:1965 ~ "60_65",
                            birth_year %in% 1970:1975 ~ "70_75",
                            birth_year %in% 1980:1985 ~ "80_85"),
                         levels = c("60_65", "70_75", "80_85")))
```

Filter out observations of people who do not belong to the chosen cohorts. Create a variable ~povteen~ that is ~TRUE~ for individuals who lived in poverty as teenagers.
```{r}
cohorts <- pov |>
  filter(!is.na(cohort)) |> 
  mutate(povteen = case_when(ecv_year == 2005 ~ 
                               fin_hardship %in% c("Very Often", "Often"),
                             ecv_year != 2005 ~
                               well_being %in% c("Very Bad", "Bad"))) |> 
  left_join(individuals, by = "id_p") |> 
  left_join(households, by = "id_hh") |> 
  mutate(income = ydisp_hh / cunits)
```

Number of people in each cohort by year:
```{r}
cohorts |> 
  count(ecv_year, cohort) |> 
  pivot_wider(names_from = cohort, values_from = n)
```

Number of people who lived in poverty as teenagers by cohort and year:  
```{r}
cohorts |> 
  filter(povteen == TRUE) |> 
  count(ecv_year, cohort) |> 
  pivot_wider(names_from = cohort, values_from = n)
```

```{r}
mod0 <- lm(pov_hh ~ (povteen + sex + country_birth) * ecv_year, data = cohorts, 
           subset = ecv_year != 2005 & cohort == "60_65")
summary(mod0)
```

```{r}
mod1 <- lm(pov_hh ~ (povteen + sex + country_birth) * ecv_year, data = cohorts, 
           subset = ecv_year != 2005 & cohort == "70_75")
summary(mod1)
```

```{r}
mod2 <- lm(pov_hh ~ (povteen + sex + country_birth) * ecv_year, data = cohorts, 
           subset = ecv_year != 2005 & cohort == "80_85")
summary(mod2)
```


```{r}
mod3 <- lm(log(income) ~ (povteen + sex + country_birth) * ecv_year, 
           data = cohorts, 
           subset = ecv_year != 2005 & cohort == "60_65")
summary(mod3)
```

```{r}
mod4 <- lm(log(income) ~ (povteen + sex + country_birth) * ecv_year, 
           data = cohorts, 
           subset = ecv_year != 2005 & cohort == "70_75")
summary(mod4)
```

```{r}
mod5 <- lm(log(income) ~ (povteen + sex + country_birth) * ecv_year, 
           data = cohorts, 
           subset = ecv_year != 2005 & cohort == "80_85")
summary(mod5)
```
